<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Tutorial: web-audio-api</title>
    
    
    
    
    
    <meta property="og:title" content=""/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content=""/>
    
    <meta property="og:url" content=""/>
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/jquery.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.css">
    <link type="text/css" rel="stylesheet" href="styles/jaguar.css">

    
    <script>
    var config = {"monospaceLinks":false,"cleverLinks":false,"applicationName":"YandexAudio","disqus":"","googleAnalytics":"","openGraph":{"title":"","type":"website","image":"","site_name":"","url":""},"meta":{"title":"","description":"","keyword":""},"linenums":true,"default":{}};
    </script>
    

    
</head>
<body>
<div id="wrap" class="clearfix">
    
<div class="navigation">
    <h3 class="applicationName"><a href="index.html">YandexAudio</a></h3>

    <div class="search">
        <input id="search" type="text" class="form-control input-sm" placeholder="Search Documentations">
    </div>
    <ul class="list">
    
        <li class="item" data-name="ya.music.Audio.config">
            <span class="title">
                <a href="ya.music.Audio.config.html">ya.music.Audio.config</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="ya.music.Audio.config.audio">
            <span class="title">
                <a href="ya.music.Audio.config.audio.html">ya.music.Audio.config.audio</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="ya.music.Audio.config.audio.retry"><a href="ya.music.Audio.config.audio.html#.retry">retry</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="ya.music.Audio.config.flash">
            <span class="title">
                <a href="ya.music.Audio.config.flash.html">ya.music.Audio.config.flash</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="ya.music.Audio.config.flash.callback"><a href="ya.music.Audio.config.flash.html#.callback">callback</a></li>
            
                <li data-name="ya.music.Audio.config.flash.clickTimeout"><a href="ya.music.Audio.config.flash.html#.clickTimeout">clickTimeout</a></li>
            
                <li data-name="ya.music.Audio.config.flash.heartBeatInterval"><a href="ya.music.Audio.config.flash.html#.heartBeatInterval">heartBeatInterval</a></li>
            
                <li data-name="ya.music.Audio.config.flash.initTimeout"><a href="ya.music.Audio.config.flash.html#.initTimeout">initTimeout</a></li>
            
                <li data-name="ya.music.Audio.config.flash.loadTimeout"><a href="ya.music.Audio.config.flash.html#.loadTimeout">loadTimeout</a></li>
            
                <li data-name="ya.music.Audio.config.flash.name"><a href="ya.music.Audio.config.flash.html#.name">name</a></li>
            
                <li data-name="ya.music.Audio.config.flash.path"><a href="ya.music.Audio.config.flash.html#.path">path</a></li>
            
                <li data-name="ya.music.Audio.config.flash.playerID"><a href="ya.music.Audio.config.flash.html#.playerID">playerID</a></li>
            
                <li data-name="ya.music.Audio.config.flash.version"><a href="ya.music.Audio.config.flash.html#.version">version</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="ya.music.Audio.config.html5">
            <span class="title">
                <a href="ya.music.Audio.config.html5.html">ya.music.Audio.config.html5</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="ya.music.Audio.config.html5.blacklist"><a href="ya.music.Audio.config.html5.html#.blacklist">blacklist</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="ya.music.Audio.fx.volumeLib">
            <span class="title">
                <a href="ya.music.Audio.fx.volumeLib.html">ya.music.Audio.fx.volumeLib</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="ya.music.Audio.fx.volumeLib.EPSILON"><a href="ya.music.Audio.fx.volumeLib.html#.EPSILON">EPSILON</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="ya.music.Audio.fx.volumeLib.fromDBFS"><a href="ya.music.Audio.fx.volumeLib.html#.fromDBFS">fromDBFS</a></li>
            
                <li data-name="ya.music.Audio.fx.volumeLib.fromExponent"><a href="ya.music.Audio.fx.volumeLib.html#.fromExponent">fromExponent</a></li>
            
                <li data-name="ya.music.Audio.fx.volumeLib.toDBFS"><a href="ya.music.Audio.fx.volumeLib.html#.toDBFS">toDBFS</a></li>
            
                <li data-name="ya.music.Audio.fx.volumeLib.toExponent"><a href="ya.music.Audio.fx.volumeLib.html#.toExponent">toExponent</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="AbortablePromise">
            <span class="title">
                <a href="AbortablePromise.html">AbortablePromise</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="AbortablePromise#abort"><a href="AbortablePromise.html#abort">abort</a></li>
            
                <li data-name="AbortablePromise#catch"><a href="AbortablePromise.html#catch">catch</a></li>
            
                <li data-name="AbortablePromise#then"><a href="AbortablePromise.html#then">then</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Promise">
            <span class="title">
                <a href="Promise.html">Promise</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Promise#catch"><a href="Promise.html#catch">catch</a></li>
            
                <li data-name="Promise#then"><a href="Promise.html#then">then</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="ya.music.Audio">
            <span class="title">
                <a href="ya.music.Audio.html">ya.music.Audio</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="ya.music.Audio#EVENT_CRASHED"><a href="ya.music.Audio.html#.EVENT_CRASHED">EVENT_CRASHED</a></li>
            
                <li data-name="ya.music.Audio#EVENT_ENDED"><a href="ya.music.Audio.html#.EVENT_ENDED">EVENT_ENDED</a></li>
            
                <li data-name="ya.music.Audio#EVENT_ERROR"><a href="ya.music.Audio.html#.EVENT_ERROR">EVENT_ERROR</a></li>
            
                <li data-name="ya.music.Audio#EVENT_LOADED"><a href="ya.music.Audio.html#.EVENT_LOADED">EVENT_LOADED</a></li>
            
                <li data-name="ya.music.Audio#EVENT_LOADING"><a href="ya.music.Audio.html#.EVENT_LOADING">EVENT_LOADING</a></li>
            
                <li data-name="ya.music.Audio#EVENT_PAUSE"><a href="ya.music.Audio.html#.EVENT_PAUSE">EVENT_PAUSE</a></li>
            
                <li data-name="ya.music.Audio#EVENT_PLAY"><a href="ya.music.Audio.html#.EVENT_PLAY">EVENT_PLAY</a></li>
            
                <li data-name="ya.music.Audio#EVENT_PROGRESS"><a href="ya.music.Audio.html#.EVENT_PROGRESS">EVENT_PROGRESS</a></li>
            
                <li data-name="ya.music.Audio#EVENT_STATE"><a href="ya.music.Audio.html#.EVENT_STATE">EVENT_STATE</a></li>
            
                <li data-name="ya.music.Audio#EVENT_STOP"><a href="ya.music.Audio.html#.EVENT_STOP">EVENT_STOP</a></li>
            
                <li data-name="ya.music.Audio#EVENT_SWAP"><a href="ya.music.Audio.html#.EVENT_SWAP">EVENT_SWAP</a></li>
            
                <li data-name="ya.music.Audio#EVENT_VOLUME"><a href="ya.music.Audio.html#.EVENT_VOLUME">EVENT_VOLUME</a></li>
            
                <li data-name="ya.music.Audio#PRELOADER_EVENT"><a href="ya.music.Audio.html#.PRELOADER_EVENT">PRELOADER_EVENT</a></li>
            
                <li data-name="ya.music.Audio#STATE_CRASHED"><a href="ya.music.Audio.html#.STATE_CRASHED">STATE_CRASHED</a></li>
            
                <li data-name="ya.music.Audio#STATE_IDLE"><a href="ya.music.Audio.html#.STATE_IDLE">STATE_IDLE</a></li>
            
                <li data-name="ya.music.Audio#STATE_INIT"><a href="ya.music.Audio.html#.STATE_INIT">STATE_INIT</a></li>
            
                <li data-name="ya.music.Audio#STATE_PAUSED"><a href="ya.music.Audio.html#.STATE_PAUSED">STATE_PAUSED</a></li>
            
                <li data-name="ya.music.Audio#STATE_PLAYING"><a href="ya.music.Audio.html#.STATE_PLAYING">STATE_PLAYING</a></li>
            
                <li data-name="ya.music.Audio.audioContext"><a href="ya.music.Audio.html#.audioContext">audioContext</a></li>
            
                <li data-name="ya.music.Audio.info"><a href="ya.music.Audio.html#.info">info</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            <span class="subtitle">Typedefs</span>
            
                <li data-name="ya.music.Audio~AudioPlayerTimes"><a href="ya.music.Audio.html#~AudioPlayerTimes">AudioPlayerTimes</a></li>
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="ya.music.Audio#clearListeners"><a href="ya.music.Audio.html#clearListeners">clearListeners</a></li>
            
                <li data-name="ya.music.Audio#getDuration"><a href="ya.music.Audio.html#getDuration">getDuration</a></li>
            
                <li data-name="ya.music.Audio#getLoaded"><a href="ya.music.Audio.html#getLoaded">getLoaded</a></li>
            
                <li data-name="ya.music.Audio#getPlayed"><a href="ya.music.Audio.html#getPlayed">getPlayed</a></li>
            
                <li data-name="ya.music.Audio#getPlayId"><a href="ya.music.Audio.html#getPlayId">getPlayId</a></li>
            
                <li data-name="ya.music.Audio#getPosition"><a href="ya.music.Audio.html#getPosition">getPosition</a></li>
            
                <li data-name="ya.music.Audio#getSrc"><a href="ya.music.Audio.html#getSrc">getSrc</a></li>
            
                <li data-name="ya.music.Audio#getState"><a href="ya.music.Audio.html#getState">getState</a></li>
            
                <li data-name="ya.music.Audio#getType"><a href="ya.music.Audio.html#getType">getType</a></li>
            
                <li data-name="ya.music.Audio#getVolume"><a href="ya.music.Audio.html#getVolume">getVolume</a></li>
            
                <li data-name="ya.music.Audio#initPromise"><a href="ya.music.Audio.html#initPromise">initPromise</a></li>
            
                <li data-name="ya.music.Audio#isDeviceVolume"><a href="ya.music.Audio.html#isDeviceVolume">isDeviceVolume</a></li>
            
                <li data-name="ya.music.Audio#isPreloaded"><a href="ya.music.Audio.html#isPreloaded">isPreloaded</a></li>
            
                <li data-name="ya.music.Audio#isPreloading"><a href="ya.music.Audio.html#isPreloading">isPreloading</a></li>
            
                <li data-name="ya.music.Audio#muteEvents"><a href="ya.music.Audio.html#muteEvents">muteEvents</a></li>
            
                <li data-name="ya.music.Audio#off"><a href="ya.music.Audio.html#off">off</a></li>
            
                <li data-name="ya.music.Audio#on"><a href="ya.music.Audio.html#on">on</a></li>
            
                <li data-name="ya.music.Audio#once"><a href="ya.music.Audio.html#once">once</a></li>
            
                <li data-name="ya.music.Audio#pause"><a href="ya.music.Audio.html#pause">pause</a></li>
            
                <li data-name="ya.music.Audio#play"><a href="ya.music.Audio.html#play">play</a></li>
            
                <li data-name="ya.music.Audio#playPreloaded"><a href="ya.music.Audio.html#playPreloaded">playPreloaded</a></li>
            
                <li data-name="ya.music.Audio#preload"><a href="ya.music.Audio.html#preload">preload</a></li>
            
                <li data-name="ya.music.Audio#restart"><a href="ya.music.Audio.html#restart">restart</a></li>
            
                <li data-name="ya.music.Audio#resume"><a href="ya.music.Audio.html#resume">resume</a></li>
            
                <li data-name="ya.music.Audio#setAudioPreprocessor"><a href="ya.music.Audio.html#setAudioPreprocessor">setAudioPreprocessor</a></li>
            
                <li data-name="ya.music.Audio#setPosition"><a href="ya.music.Audio.html#setPosition">setPosition</a></li>
            
                <li data-name="ya.music.Audio#setVolume"><a href="ya.music.Audio.html#setVolume">setVolume</a></li>
            
                <li data-name="ya.music.Audio#stop"><a href="ya.music.Audio.html#stop">stop</a></li>
            
                <li data-name="ya.music.Audio#toggleWebAudioAPI"><a href="ya.music.Audio.html#toggleWebAudioAPI">toggleWebAudioAPI</a></li>
            
                <li data-name="ya.music.Audio#unmuteEvents"><a href="ya.music.Audio.html#unmuteEvents">unmuteEvents</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            <span class="subtitle">Events</span>
            
                <li data-name="ya.music.Audio#event:EVENT_CRASHED"><a href="ya.music.Audio.html#event:EVENT_CRASHED">EVENT_CRASHED</a></li>
            
                <li data-name="ya.music.Audio#event:EVENT_ENDED"><a href="ya.music.Audio.html#event:EVENT_ENDED">EVENT_ENDED</a></li>
            
                <li data-name="ya.music.Audio#event:EVENT_ERROR"><a href="ya.music.Audio.html#event:EVENT_ERROR">EVENT_ERROR</a></li>
            
                <li data-name="ya.music.Audio#event:EVENT_LOADED"><a href="ya.music.Audio.html#event:EVENT_LOADED">EVENT_LOADED</a></li>
            
                <li data-name="ya.music.Audio#event:EVENT_LOADING"><a href="ya.music.Audio.html#event:EVENT_LOADING">EVENT_LOADING</a></li>
            
                <li data-name="ya.music.Audio#event:EVENT_PAUSE"><a href="ya.music.Audio.html#event:EVENT_PAUSE">EVENT_PAUSE</a></li>
            
                <li data-name="ya.music.Audio#event:EVENT_PLAY"><a href="ya.music.Audio.html#event:EVENT_PLAY">EVENT_PLAY</a></li>
            
                <li data-name="ya.music.Audio#event:EVENT_PROGRESS"><a href="ya.music.Audio.html#event:EVENT_PROGRESS">EVENT_PROGRESS</a></li>
            
                <li data-name="ya.music.Audio#event:EVENT_STATE"><a href="ya.music.Audio.html#event:EVENT_STATE">EVENT_STATE</a></li>
            
                <li data-name="ya.music.Audio#event:EVENT_STOP"><a href="ya.music.Audio.html#event:EVENT_STOP">EVENT_STOP</a></li>
            
                <li data-name="ya.music.Audio#event:EVENT_SWAP"><a href="ya.music.Audio.html#event:EVENT_SWAP">EVENT_SWAP</a></li>
            
                <li data-name="ya.music.Audio#event:EVENT_VOLUME"><a href="ya.music.Audio.html#event:EVENT_VOLUME">EVENT_VOLUME</a></li>
            
                <li data-name="ya.music.Audio#event:PRELOADER_EVENT+EVENT_ERROR"><a href="ya.music.Audio.html#event:PRELOADER_EVENT+EVENT_ERROR">PRELOADER_EVENT+EVENT_ERROR</a></li>
            
                <li data-name="ya.music.Audio#event:PRELOADER_EVENT+EVENT_LOADED"><a href="ya.music.Audio.html#event:PRELOADER_EVENT+EVENT_LOADED">PRELOADER_EVENT+EVENT_LOADED</a></li>
            
                <li data-name="ya.music.Audio#event:PRELOADER_EVENT+EVENT_LOADING"><a href="ya.music.Audio.html#event:PRELOADER_EVENT+EVENT_LOADING">PRELOADER_EVENT+EVENT_LOADING</a></li>
            
                <li data-name="ya.music.Audio#event:PRELOADER_EVENT+EVENT_PROGRESS"><a href="ya.music.Audio.html#event:PRELOADER_EVENT+EVENT_PROGRESS">PRELOADER_EVENT+EVENT_PROGRESS</a></li>
            
                <li data-name="ya.music.Audio#event:PRELOADER_EVENT+EVENT_STOP"><a href="ya.music.Audio.html#event:PRELOADER_EVENT+EVENT_STOP">PRELOADER_EVENT+EVENT_STOP</a></li>
            
            </ul>
        </li>
    
        <li class="item" data-name="ya.music.Audio.AudioError">
            <span class="title">
                <a href="ya.music.Audio.AudioError.html">ya.music.Audio.AudioError</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="ya.music.Audio.AudioError.BAD_STATE"><a href="ya.music.Audio.AudioError.html#.BAD_STATE">BAD_STATE</a></li>
            
                <li data-name="ya.music.Audio.AudioError.FLASH_BLOCKER"><a href="ya.music.Audio.AudioError.html#.FLASH_BLOCKER">FLASH_BLOCKER</a></li>
            
                <li data-name="ya.music.Audio.AudioError.FLASH_EMMITER_NOT_FOUND"><a href="ya.music.Audio.AudioError.html#.FLASH_EMMITER_NOT_FOUND">FLASH_EMMITER_NOT_FOUND</a></li>
            
                <li data-name="ya.music.Audio.AudioError.FLASH_INIT_TIMEOUT"><a href="ya.music.Audio.AudioError.html#.FLASH_INIT_TIMEOUT">FLASH_INIT_TIMEOUT</a></li>
            
                <li data-name="ya.music.Audio.AudioError.FLASH_INTERNAL_ERROR"><a href="ya.music.Audio.AudioError.html#.FLASH_INTERNAL_ERROR">FLASH_INTERNAL_ERROR</a></li>
            
                <li data-name="ya.music.Audio.AudioError.FLASH_NOT_RESPONDING"><a href="ya.music.Audio.AudioError.html#.FLASH_NOT_RESPONDING">FLASH_NOT_RESPONDING</a></li>
            
                <li data-name="ya.music.Audio.AudioError.FLASH_UNKNOWN_CRASH"><a href="ya.music.Audio.AudioError.html#.FLASH_UNKNOWN_CRASH">FLASH_UNKNOWN_CRASH</a></li>
            
                <li data-name="ya.music.Audio.AudioError.NOT_PRELOADED"><a href="ya.music.Audio.AudioError.html#.NOT_PRELOADED">NOT_PRELOADED</a></li>
            
                <li data-name="ya.music.Audio.AudioError.NO_IMPLEMENTATION"><a href="ya.music.Audio.AudioError.html#.NO_IMPLEMENTATION">NO_IMPLEMENTATION</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="ya.music.Audio.fx.Equalizer">
            <span class="title">
                <a href="ya.music.Audio.fx.Equalizer.html">ya.music.Audio.fx.Equalizer</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="ya.music.Audio.fx.Equalizer.DEFAULT_BANDS"><a href="ya.music.Audio.fx.Equalizer.html#.DEFAULT_BANDS">DEFAULT_BANDS</a></li>
            
                <li data-name="ya.music.Audio.fx.Equalizer.DEFAULT_PRESETS"><a href="ya.music.Audio.fx.Equalizer.html#.DEFAULT_PRESETS">DEFAULT_PRESETS</a></li>
            
                <li data-name="ya.music.Audio.fx.Equalizer#EVENT_CHANGE"><a href="ya.music.Audio.fx.Equalizer.html#.EVENT_CHANGE">EVENT_CHANGE</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            <span class="subtitle">Typedefs</span>
            
                <li data-name="ya.music.Audio.fx.Equalizer~EqualizerPreset"><a href="ya.music.Audio.fx.Equalizer.html#~EqualizerPreset">EqualizerPreset</a></li>
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="ya.music.Audio.fx.Equalizer#clearListeners"><a href="ya.music.Audio.fx.Equalizer.html#clearListeners">clearListeners</a></li>
            
                <li data-name="ya.music.Audio.fx.Equalizer#guessPreamp"><a href="ya.music.Audio.fx.Equalizer.html#guessPreamp">guessPreamp</a></li>
            
                <li data-name="ya.music.Audio.fx.Equalizer#loadPreset"><a href="ya.music.Audio.fx.Equalizer.html#loadPreset">loadPreset</a></li>
            
                <li data-name="ya.music.Audio.fx.Equalizer#muteEvents"><a href="ya.music.Audio.fx.Equalizer.html#muteEvents">muteEvents</a></li>
            
                <li data-name="ya.music.Audio.fx.Equalizer#off"><a href="ya.music.Audio.fx.Equalizer.html#off">off</a></li>
            
                <li data-name="ya.music.Audio.fx.Equalizer#on"><a href="ya.music.Audio.fx.Equalizer.html#on">on</a></li>
            
                <li data-name="ya.music.Audio.fx.Equalizer#once"><a href="ya.music.Audio.fx.Equalizer.html#once">once</a></li>
            
                <li data-name="ya.music.Audio.fx.Equalizer#savePreset"><a href="ya.music.Audio.fx.Equalizer.html#savePreset">savePreset</a></li>
            
                <li data-name="ya.music.Audio.fx.Equalizer#unmuteEvents"><a href="ya.music.Audio.fx.Equalizer.html#unmuteEvents">unmuteEvents</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            <span class="subtitle">Events</span>
            
                <li data-name="ya.music.Audio.fx.Equalizer#event:EVENT_CHANGE"><a href="ya.music.Audio.fx.Equalizer.html#event:EVENT_CHANGE">EVENT_CHANGE</a></li>
            
            </ul>
        </li>
    
        <li class="item" data-name="ya.music.Audio.fx.Equalizer~EqualizerBand">
            <span class="title">
                <a href="ya.music.Audio.fx.Equalizer-EqualizerBand.html">ya.music.Audio.fx.Equalizer~EqualizerBand</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="ya.music.Audio.fx.Equalizer~EqualizerBand#clearListeners"><a href="ya.music.Audio.fx.Equalizer-EqualizerBand.html#clearListeners">clearListeners</a></li>
            
                <li data-name="ya.music.Audio.fx.Equalizer~EqualizerBand#getFreq"><a href="ya.music.Audio.fx.Equalizer-EqualizerBand.html#getFreq">getFreq</a></li>
            
                <li data-name="ya.music.Audio.fx.Equalizer~EqualizerBand#getValue"><a href="ya.music.Audio.fx.Equalizer-EqualizerBand.html#getValue">getValue</a></li>
            
                <li data-name="ya.music.Audio.fx.Equalizer~EqualizerBand#muteEvents"><a href="ya.music.Audio.fx.Equalizer-EqualizerBand.html#muteEvents">muteEvents</a></li>
            
                <li data-name="ya.music.Audio.fx.Equalizer~EqualizerBand#off"><a href="ya.music.Audio.fx.Equalizer-EqualizerBand.html#off">off</a></li>
            
                <li data-name="ya.music.Audio.fx.Equalizer~EqualizerBand#on"><a href="ya.music.Audio.fx.Equalizer-EqualizerBand.html#on">on</a></li>
            
                <li data-name="ya.music.Audio.fx.Equalizer~EqualizerBand#once"><a href="ya.music.Audio.fx.Equalizer-EqualizerBand.html#once">once</a></li>
            
                <li data-name="ya.music.Audio.fx.Equalizer~EqualizerBand#setValue"><a href="ya.music.Audio.fx.Equalizer-EqualizerBand.html#setValue">setValue</a></li>
            
                <li data-name="ya.music.Audio.fx.Equalizer~EqualizerBand#unmuteEvents"><a href="ya.music.Audio.fx.Equalizer-EqualizerBand.html#unmuteEvents">unmuteEvents</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="ya.music.Audio.LoaderError">
            <span class="title">
                <a href="ya.music.Audio.LoaderError.html">ya.music.Audio.LoaderError</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="ya.music.Audio.LoaderError.FAILED"><a href="ya.music.Audio.LoaderError.html#.FAILED">FAILED</a></li>
            
                <li data-name="ya.music.Audio.LoaderError.TIMEOUT"><a href="ya.music.Audio.LoaderError.html#.TIMEOUT">TIMEOUT</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="ya.music.Audio.Logger">
            <span class="title">
                <a href="ya.music.Audio.Logger.html">ya.music.Audio.Logger</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="ya.music.Audio.Logger.ignores"><a href="ya.music.Audio.Logger.html#.ignores">ignores</a></li>
            
                <li data-name="ya.music.Audio.Logger.logLevels"><a href="ya.music.Audio.Logger.html#.logLevels">logLevels</a></li>
            
                <li data-name="ya.music.Audio.Logger#debug"><a href="ya.music.Audio.Logger.html#debug">debug</a></li>
            
                <li data-name="ya.music.Audio.Logger#error"><a href="ya.music.Audio.Logger.html#error">error</a></li>
            
                <li data-name="ya.music.Audio.Logger#info"><a href="ya.music.Audio.Logger.html#info">info</a></li>
            
                <li data-name="ya.music.Audio.Logger#log"><a href="ya.music.Audio.Logger.html#log">log</a></li>
            
                <li data-name="ya.music.Audio.Logger#showUrl"><a href="ya.music.Audio.Logger.html#showUrl">showUrl</a></li>
            
                <li data-name="ya.music.Audio.Logger#trace"><a href="ya.music.Audio.Logger.html#trace">trace</a></li>
            
                <li data-name="ya.music.Audio.Logger#warn"><a href="ya.music.Audio.Logger.html#warn">warn</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="ya.music.Audio.Logger.log"><a href="ya.music.Audio.Logger.html#.log">log</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="ya.music.Audio.PlaybackError">
            <span class="title">
                <a href="ya.music.Audio.PlaybackError.html">ya.music.Audio.PlaybackError</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="ya.music.Audio.PlaybackError.BAD_DATA"><a href="ya.music.Audio.PlaybackError.html#.BAD_DATA">BAD_DATA</a></li>
            
                <li data-name="ya.music.Audio.PlaybackError.CONNECTION_ABORTED"><a href="ya.music.Audio.PlaybackError.html#.CONNECTION_ABORTED">CONNECTION_ABORTED</a></li>
            
                <li data-name="ya.music.Audio.PlaybackError.DECODE_ERROR"><a href="ya.music.Audio.PlaybackError.html#.DECODE_ERROR">DECODE_ERROR</a></li>
            
                <li data-name="ya.music.Audio.PlaybackError.DONT_START"><a href="ya.music.Audio.PlaybackError.html#.DONT_START">DONT_START</a></li>
            
                <li data-name="ya.music.Audio.PlaybackError.NETWORK_ERROR"><a href="ya.music.Audio.PlaybackError.html#.NETWORK_ERROR">NETWORK_ERROR</a></li>
            
                <li data-name="ya.music.Audio.PlaybackError.html5"><a href="ya.music.Audio.PlaybackError.html#.html5">html5</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
    </ul>
</div>
    <div class="main">
        <h1 class="page-title" data-filename="tutorial-web-audio-api.html">Tutorial: web-audio-api</h1>
        <section>

<header>
    

</header>

<article>
    <h1>Web Audio API</h1><p>Web Audio API - это технология, позволяющая существенно расширить возможности воспроизведения звука в браузере. К сожалению, на данный момент эта технология очень молодая и ее поддержка есть только в свежих версиях популярных десктопных браузеров и практически отсутствует в мобильных браузерах.</p>
<p>У Web Audio API стоит выделить 3 основных аспекта, которые особо не пересекаются и их можно рассматривать отдельно:</p>
<ul>
<li>возможности работы с различными источниками сигнала</li>
<li>возможности по анализу сигнала</li>
<li>возможности по цифровой обработке сигнала</li>
</ul>
<p>В этой статье я постараюсь объяснить назначение каждого элемента. Она получается и так достаточно большой, так что большую часть информации об интерфейсах я опустил (она доступна по ссылкам на документацию), а основное внимание сосредоточил на вещах, которые не очевидны после прочтения документации.</p>
<h2>Работа с Web Audio API</h2><p>Центральный элемент данного API - это <code>AudioContext</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioContext">man</a>). Данный элемент предоставляет все необходимые фабрики для создания остальных элементов, а также имеет методы для управления состоянием всего графа (<code>AudioContext#resume</code>, <code>AudioContext#suspend</code>). Плюс к тому, через данный элемент можно получать информацию о таких вещах, как время воспроизведения (<code>AudioContext#currentTime</code>), частоте дискретизации (<code>AudioContext#sampleRate</code>) и текущем статусе графа.</p>
<h3>Построение графа</h3><p>Как уже стало понятно из предыдущего абзаца, элементы Web Audio API связываются в некий граф, в котором определен порядок передачи сигнала от отного элемента другому. Все элементы, связываемые таким образом, являются потомками класса <code>AudioNode</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioNode">man</a>)</p>
<p>Для простоты назовем сигнал, передающийся между 2 элементами <code>AudioNode</code>, потоком. У каждого элемента есть какое-то количество входов и выходов потока. Не стоит путать количество входов с количеством подключенных потоков. К любому входу можно подключить неограниченное количество потоков. Аналогично дела обстоят с выходами. Большинство элементов имеет по 1 входу и выходу. Источники сигнала не имеют входов, а выводящие элементы (которые воспроизводят звук или создают сетевой поток), не имеют выходов.</p>
<ul>
<li><code>AudioNode#connect</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioNode/connect%28AudioNode%29">man</a>) - данный метод подключает один элемент к другому, создавая поток. Данный метод принимает 3 аргумента - элемент назначения, номер выхода текущего элемента, который следует использовать, и номер входа, к которому нужно подключить текущий элемент. Элементом назначения может быть не только <code>AudioNode</code>, но и <code>AudioParam</code> - это позволяет контролировать некий параметр с помощью аудиосигнала. Я расскажу об этой возможности подробнее в разделе про обработку сигнала.</li>
<li><code>AudioNode#disconnect</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioNode/disconnect">man</a>) - данный метод отключает все исходящие потоки. В документации указано, что у данного метода есть необязательные аргументы, аналогичные методу <code>AudioNode#connect</code>, но на деле поддержка этих аргументов есть только в последних версиях Chrome.</li>
</ul>
<p>Также стоит отдельно рассмотреть 2 элемента, которые позволяют разделять и объединять каналы:</p>
<ul>
<li><code>ChannelSplitterNode</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/API/ChannelSplitterNode">man</a>) - элемент, который принимает на вход один многоканальный поток и выдает набор моноканальных потоков;</li>
<li><code>ChannelMergerNode</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/API/ChannelMergerNode">man</a>) - элемент, который принимает на вход множество моноканальных потоков и выдает один многоканальный поток.</li>
</ul>
<h3>Каналы</h3><p>Стоит отдельно упомянуть про работу с многоканальным звуком. Каждый элемент <code>AudioNode</code> имеет свои параметры, указывающие на количество каналов, с которыми он работает и то, каким образом данные каналы следует интерпретировать.</p>
<ul>
<li><code>AudioNode#channelCount</code> - настройка количества используемых каналов.</li>
<li><code>AudioNode#channelCountMode</code> - настройка автоматического расчета количества каналов. Принимает одно из значений:<ul>
<li><code>&quot;max&quot;</code> - количество каналов выбирается равным максимальному количеству каналов у подключенных источников;</li>
<li><code>&quot;clamped-max&quot;</code> - аналогично <code>&quot;max&quot;</code>, но значение ограничено сверху параметром <code>AudioNode#channelCount</code>;</li>
<li><code>&quot;explicit&quot;</code> - автоматический расчет отключен, количество каналов точно равно <code>AudioNode#channelCount</code>.</li>
</ul>
</li>
<li><code>AudioNode#channelInterpretation</code> - (<a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioNode/channelInterpretation">man</a>) самая интересная настройка. Она отвечает за то, что будет происходить, если соединить 2 элемента, у которых разное количество каналов. Параметр может принимать одно из значений:<ul>
<li><code>&quot;speakers&quot;</code> - каналы рассматриваются, как каналы стандартной воспроизводящей аппаратуры (см. таблицу в <a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioNode/channelInterpretation">документации</a>). При расхождении в количестве каналов происходит автоматическое смешение каналов (если на вход подается больше каналов, чем у элемента) или разделение (если на вход подается меньше каналов, чем у элемента).</li>
<li><code>&quot;discrete&quot;</code> - смешение и разделение каналов отключено.</li>
</ul>
</li>
</ul>
<p>Для большинства элементов <code>AudioNode#channelCountMode</code> выставлен в значение <code>&quot;max&quot;</code>, так что при работе с ними можно не обращать внимания на все эти настройки. Рассмотрим отдельно элементы, в которых используются другие значения.</p>
<ul>
<li><code>PannerNode</code> - для этого элемента существует 2 ограничения:<ul>
<li>значение <code>PannerNode#channelCountMode</code> может быть только <code>&quot;clamped-max&quot;</code> или <code>&quot;explicit&quot;</code>;</li>
<li>значение <code>PannerNode#channelCount</code> можеть быть только 1 или 2.</li>
</ul>
</li>
<li><code>ConvolverNode</code> - для этого элемента значения по умолчанию <code>ConvolverNode#channelCountMode = &quot;clamped-max&quot;</code> и <code>ConvolverNode#channelCount = 2</code>, но их можно произвольно менять. Однако есть ограничение на количество каналов буфера, используемого при расчете свертки - их может быть 1, 2 или 4.</li>
<li><code>AudioDestinationNode</code> - для этого элемента значения по умолчанию <code>AudioDestinationNode#channelCountMode = &quot;explicit&quot;</code> и <code>AudioDestinationNode#channelCount = 2</code>. Можно выставить любое значение для автоматического расчета количества каналов, но для настройки <code>AudioDestinationNode#channelCount</code> есть ограничение в количество каналов, которое поддерживается системой. Это значение можно узнать из <code>AudioDestinationNode#maxChannelCount</code>.</li>
<li><code>AnalyserNode</code> - по умолчанию имеет ровно 1 канал. Эту настройку можно изменять как угодно. Но если количество каналов больше 1, то данные для буфера для анализа будут браться как усредненное значение всех доступных каналов. Кстати, т.к. используется всего 1 канал, при анализе звука лучше использовать этот элемент параллельно с основной линией вывода звука, а не встраивать его в нее, как показано в документации.</li>
<li><code>DynamicsCompressorNode</code> - по умолчанию имеет настройки <code>DynamicsCompressorNode#channelCountMode = &quot;explicit&quot;</code> и <code>DynamicsCompressorNode#channelCount = 2</code>. Однако данный элемент не имеет никаких ограничений в настройках (почему и для чего разработчики выставили такие параметры по умолчанию, остается загадкой).</li>
</ul>
<p>Рассказывая про работу с каналами, нельзя не упомянуть про <code>StereoPannerNode</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/API/StereoPannerNode">man</a>), который позволяет регулировать баланс каналов. Данный элемент позволяет усиливать звук в одном канале, одновременно ослабляя его в другом канале.</p>
<h2>Каналы вывода</h2><p>Web Audio API может использовать для вывода результирующего сигнала системное аудиоустройство или медиа-поток. Плюс к тому, существует специальный контекст <code>OfflineAudioContext</code>, который позволяет выводить данные в аудиобуфер. Элементы, которые реализуют данный функционал, являются <code>AudioNode</code> - достаточно добавить их в граф, присоединив к нужным нодам, чтобы начался вывод данных.</p>
<h3><a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioDestinationNode">AudioDestinationNode</a></h3><p>Данный элемент нельзя создать - он является свойством <code>#destination</code> аудиоконтекста и в зависимости от того, какой это контекст, может использоваться либо для вывода звука через системное аудиоустройство (если используется <code>AudioContext</code>), либо для записи аудиобуфера (если используется <code>OfflineAudioContext</code>).</p>
<h3><a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaStreamAudioDestinationNode">MediaStreamAudioDestinationNode</a></h3><p>Данный элемент позволяет выводить аудиосигнал в медиа-поток <code>MediaStream</code>, который создается при вызове фабрики <code>AudioContext#createMediaStreamDestination</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioContext/createMediaStreamDestination">man</a>). После создания элемента медиа-поток доступен через свойство <code>MediaStreamAudioDestinationNode#stream</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaStreamAudioDestinationNode/stream">man</a>).</p>
<h2>Источники сигнала</h2><p>Web Audio API работает с цифровыми сигналами, которые могут быть получены из самых разных источников или созданы непосредственно с помощью скриптов. Элементы Web Audio API, которые могут генерировать некий сигнал, будем называть источниками сигнала, а любые посторониие объекты, которые могут быть использованы для генерации этого сигнала, будем называть источниками данных.</p>
<p>В отличие от медиа-элементов у Web Audio API нет методов получения данных по сети или из файловой системы. Вместо этого есть 3 типа источников данных, которые позволяют решать проблему получения данных самыми разнообразными способами, которые не доступны медиа-элементам.</p>
<h3><a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaElementAudioSourceNode">MediaElementAudioSourceNode</a></h3><p>Начнем с самого простого. Источником данных этого элемента является <code>&lt;audio&gt;</code> или <code>&lt;video&gt;</code> элемент. </p>
<p>Фабрика <code>AudioContext#createMediaElementSource</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioContext/createMediaElementSource">man</a>) принимает в качестве единственного параметра медиа-элемент (<code>&lt;audio&gt;</code> или <code>&lt;video&gt;</code>). При этом создание <code>MediaElementAudioSourceNode</code> перенапрявляет вывод аудиопотока из медиа-элемента в данный объект. Остальное поведение медиа-элемента при этом не изменяется.</p>
<p>Стоит отметить 3 вещи:</p>
<ul>
<li>у медиа-элемента по-прежнему работают функции изменения громкости. Для целей воспроизведения это может не иметь особого значения, но если требуется проводить анализ сигнала, лучше всего выставить медиа-элементу максимальную громкость, а итоговую громкость на выходе регулировать с помощью GainNode (об этом еще будет рассказано позднее).</li>
<li>Web Audio API требует специальных прав на получение данных из медиа-элемента. Если трек загружается с другого сервера, то для корректной работы <code>MediaElementAudioSourceNode</code> требуется, чтобы у медиа-элемента был выставлен параметр <code>crossOrigin</code> и в ответах сервера приходил корректный заголовок <code>Access-Control-Allow-Access</code>. В противном случае этот элемент нельзя будет использовать в качестве источника данных для Web Audio API.</li>
<li>нельзя отключить этот элемент от медиа-элемента. Т.е. чтобы данный медиа-элемент мог воспроизводить звук, требуется, чтобы связанный с ним <code>MediaElementAudioSourceNode</code> был подключен к основному выводу контекста.</li>
</ul>
<p>Посмотреть реализацию можно <a href="https://github.yandex-team.ru/music/audio/blob/master/src/html5/audio-html5-loader.js#L844">тут</a></p>
<h3><a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaStreamAudioSourceNode">MediaStreamAudioSourceNode</a></h3><p>Источником данных этого элемента является аудиовход или любой другой источник, настроенный в системе или браузере пользователя.</p>
<p>Фабрика <code>AudioContext#createMediaStreamSource</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioContext/createMediaStreamSource">man</a>) принимает в качестве единственного параметра медиа-поток, получаемый из метода <code>MediaDevices.getUserMedia</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia">man</a>). Основное применение данного источника - использование микрофона или линейного входа в качестве источника аудиоданных. Тут вроде подводных камней нет.</p>
<h3><a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioBufferSourceNode">AudioBufferSourceNode</a></h3><p>Источником данных этого элемента является <a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioBuffer">AudioBuffer</a>. Это, пожалуй, самый интересный тип источников сигнала, т.к. он предоставляет те возможности, которые отсутсвуют у медиа-элементов. С помощью аудиобуфера можно формировать любой сигнал непосредственно в браузере (например, таким образом это делается здесь <a href="http://wavepot.com/">wavepot.com</a>).</p>
<h4>Непосредственное создание и заполнение буфера</h4><p>Самый банальный метод - непосредственное создание и заполнение этого буфера. Фабрика <code>AudioContext#createBuffer</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioContext/createBuffer">man</a>) принимает 3 параметра:</p>
<ul>
<li>количество каналов;</li>
<li>количество семплов;</li>
<li>частоту дискретизации.</li>
</ul>
<p>Буфер может иметь до 32 каналов. Каждый канал содержит информацию о сигнале в формате PCM.</p>
<h4>Декодирование сжатых аудиоданных</h4><p>Также можно создать буфер из сжатых аудиоданных. Для этого используется метод <code>AudioContext#decodeAudioData</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioContext/decodeAudioData">man</a>). Он принимает 2 параметра:</p>
<ul>
<li>сжатые аудиоданные;</li>
<li>обработчик, в который будет передан объект <code>AudioBuffer</code> с декодированными данными.</li>
</ul>
<p>Благодаря этому методу можно не только вручную контролировать процесс загрузки данных, но и, например, сохранять их в localStorage (для больших файлов не подойдет, но короткий &quot;блямк&quot; вполне можно сохранить). Однако стоит помнить про то, что буфер содержит несжатые данные. Каждый семпл в каждом канале - это 32 битное число с плавающей точкой, так что 5 минутный стерео-трек займет 106 мегабайт памяти. Так что если вы решите загрузить целиком 9 симфонию Бетховена (длительность симфонии 74 минуты), то она займет 783 мегабайта в монорежиме и 1,5 гигабайта в стерео.</p>
<h4>Использование <a href="https://developer.mozilla.org/en-US/docs/Web/API/OfflineAudioContext">OfflineAudioContext</a></h4><p>Самый нетривиальный метод создания аудиобуфера. Элемент <code>OfflineAudioContext</code> работает примерно так же, как обычный <code>AudioContext</code>, но вместо вывода аудиопотока на устройства воспроизведения, он рассчитывает аудиобуфер. Конструктор (кстати, это единственный элемент, кроме <code>AudioContext</code>, который создается с помощью конструктора, а не фабрики) принимает те же параметры, что и <code>AudioContext#createBuffer</code>.</p>
<p>Данный элемент позволяет произвести необходимые преобразования звука заранее, а затем многократно переиспользовать полученный аудиобуфер вместо повторных вычислений в рантайме. Возможности по формированию и обработке сигнала в данном случае ограничены только воображением.</p>
<p>Кстати, <code>AudioNode</code> привязывается к контексту, в котором был создан. Нельзя объединять ноды, созданные в разных контекстах. <code>OfflineAudioContext</code> является отдельным контекстом, так что для него нужны отдельные обрабатывающие ноды.</p>
<p>Итоговый буфер, который получается в результате работы данного контекста, передается в событие <code>complete</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/API/OfflineAudioCompletionEvent">OfflineAudioCompletionEvent</a>). Также можно его получать через обещание, которое возвращает метод <code>OfflineAudioContext#startRendering</code> - однако обещания данный метод стал выдавать относительно недавно и не все браузеры поддерживают такой API.</p>
<h3><a href="https://developer.mozilla.org/en-US/docs/Web/API/OscillatorNode">OscillatorNode</a></h3><p>Этот элемент - самый простой и логичный генератор сигналов. Он просто генерирует периодический сигнал с заданной частотой. Форму волны при этом можно задавать указывая один из заранее заданных <a href="https://developer.mozilla.org/en-US/docs/Web/API/OscillatorNode/type">типов</a> или с помощью элементов <code>PeriodicWave</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/API/PeriodicWave">man</a>).</p>
<p><code>PeriodicWave</code> - является элементом, описывающим форму некоторой периодически повторяющейся волны. Форма волны задается с помощью коэффициентов для обратного Быстрого Преобразование Фурье. Максимальное количество коэфициентов = 4096.</p>
<p>Фабрика <code>AudioContext#createPeriodicWave</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioContext/createPeriodicWave">man</a>) принимает 3 аргумента:</p>
<ul>
<li>массив коэффициентов для обратного Быстрого Преобразования Фурье (вещественная часть);</li>
<li>массив коэффициентов для обратного Быстрого Преобразования Фурье (мнимая часть);</li>
<li>опциональный объект <code>{disableNormalization: true}</code>, отключающий нормализацию волны.</li>
</ul>
<p>Чтобы понять, как разные коэффициенты влияют на форму волны, можно посмотреть данную <a href="https://www.desmos.com/calculator/lmzpimpbou">демонстрацию</a>. Под графиком расположены 8 контрольных точек, которые можно передвигать, чтобы изменять коэффициенты. По оси x отсчитывается вещественная часть коэффициента, по оси y - мнимая. Графики отображают вещественную и мнимую части волны после обратного Преобразования Фурье.</p>
<p>Стоит учитывать, однако, что вне зависимости от количеста коэффициентов, которые будут переданы в фабрику, общее количество отсчетов, которое будет использовано для обратного преобразования, будет равно 4096.</p>
<h2>Анализ сигнала</h2><p>Для анализа данных аудиопотока можно использовать 2 различных подхода:</p>
<ul>
<li>анализ данных непосредственно из аудиобуфера (Web Audio API в этом нам не помощник, данная библиотека только предоставит массив данных - дальше нужно самостоятельно описывать функции обработки этих данных).</li>
<li>анализ данных с помощью <code>AnalyserNode</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/API/AnalyserNode">man</a>).</li>
</ul>
<h3>AudioBuffer</h3><p>Я не буду здесь расписывать, каким образом можно использовать данные аудиобуфера, т.к. это не относится к Web Audio API напрямую. Получить данные любого канала можно с помощью методов <code>AudioBuffer#getChannelData</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioBuffer/getChannelData">man</a>) и <code>AudioBuffer#copyFromChannel</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioBuffer/copyFromChannel">man</a>).</p>
<h3><a href="https://developer.mozilla.org/en-US/docs/Web/API/AnalyserNode">AnalyzerNode</a></h3><p>Данный элемент используется для анализа данных аудиопотока в реальном времени. Он содержит в себе буфер данных, который заполняется по мере воспроизведения потока, т.е. содержит текущее окно преобразования. К этому буферу применяется Быстрое Преобразование Фурье. Данные преобразования можно получить с помощью методов:</p>
<ul>
<li><code>AnalyserNode#getFloatFrequencyData</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/API/AnalyserNode/getFloatFrequencyData">man</a>, передает данные в Float32Array)</li>
<li><code>AnalyserNode#getByteFrequencyData</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/API/AnalyserNode/getByteFrequencyData">man</a>, передает данные в Uint8Array)</li>
</ul>
<p>Данные анализируемого буфера можно получить с помощью методов:</p>
<ul>
<li><code>AnalyserNode#getFloatTimeDomainData</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/API/AnalyserNode/getFloatTimeDomainData">man</a>, передает данные в Float32Array)</li>
<li><code>AnalyserNode#getByteTimeDomainData</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/API/AnalyserNode/getByteTimeDomainData">man</a>, передает данные в Uint8Array)</li>
</ul>
<h4>Быстрое Преобразование Фурье</h4><p>В статье про <a href="https://github.yandex-team.ru/pages/music/audio/tutorial-sound.html">теорию звука</a> я постарался избежать описания данного алгоритма, но здесь стоит о нем рассказать, чтобы было понятно, для чего он нужен и какие данные с помощью него можно получить.</p>
<p>Быстрым Преобразованим Фурье (БПФ) называется семейство алгоритмов, позволяющих выполнять Дискретное Преобразование Фурье (ДПФ) значительно быстрее. Дискретное Преобразование Фурье в свою очередь позволяет для последовательности отсчетов сигнала получить набор частотных и фазовых характеристик этого сигнала в виде набора комплексных чисел. Вообще говоря, это преобразование над комплексными числами, но в цифровом сигнале у нас есть только вещественная часть, и все мнимые компоненты будут равны нулю.</p>
<p>Чтобы понять, для чего нужно ДПФ, проще всего рассмотреть обратное ДПФ. Входными данными для этого преобразования является набор комплексных чисел, которые отражают частотные и фазовые характеристики некого сигнала, а выходными данными является непосредственно сам цифровой сигнал. Каков смысл этих чисел? На самом деле все просто. Рассмотрим <a href="https://www.desmos.com/calculator/lmzpimpbou">демонстрацию</a>, которую я уже приводил в разделе про <code>PeriodicWave</code>. В этой демонстрации строится непрерывная бесконечная функция, а не дискретный конечный сигнал, но в плане наглядности так даже лучше. Нас будет интересовать только часть, ограниченная 2 вертиальными оранжевыми линиями.</p>
<p>Вещественная часть самого первого аргумента всего лишь поднимает/опускает вещественную часть в результирующей функции. Мнимая часть делает то же самое с мнимой частью функции.</p>
<p>Остальные аргументы более интересны. Модуль любого из этих чисел (длина радиус-вектора) указывает амплитуду некой синусоиды, а аргумент числа (угол наклона радиус-вектора) - фазу этой синусоиды в точке 0. Длина волны каждой синусоиды зависит от порядкового номера числа L = N / (n - 1), где L - длина волны в системе координат преобразования, N - количество отсчетов, n - порядковый номер аргумента. Таким образом второй аргумент задает синусоиду с длинной волны, равной количеству отсчетов, третий - с длинной волны в 2 раза меньше, четвертый - с длинной волны в 3 раза меньше и т.д. Все полученные синусоиды просто складываются друг с другом по принципу суперпозиции.</p>
<p>Таким образом, если обратное ДПФ из коэффициентов строит цифровой сигнал, то прямое ДПФ из цифрового сигнала получает эти самые коэффициенты, т.е. позволяет разложить наш сигнал в набор синусоид различной частоты. Возьмем к примеру сигнал, состоящий из 2х синусоид: <img class="image__inline" src="https://tex.s2cms.ru/svg/f(x)%3D%200.3%20*%20sin(x%20%2B%20%5Ccfrac%7B%5Cpi%7D%7B2%7D)%20%2B%200.7%20*%20sin(%5Ccfrac%7B1%7D%7B2%7D(x%20%2B%20%5Ccfrac%7B%5Cpi%7D%7B3%7D))" alt="f(x) = 0.3 * sin(x + pi/2) + 0.7 * sin(0.5 * (x + pi/3))" />.</p>
<p><img src="images/sin.png" width="100%" alt="Рис 1. Параметры синусоидальных сигналов." />
<em>Рис 1. Параметры синусоидальных сигналов.</em></p>
<ul>
<li><img class="image__inline" src="https://tex.s2cms.ru/svg/L_1%20%3D%202%5Cpi" alt="L1 = 2pi" /> - период первой синусоиды;</li>
<li><img class="image__inline" src="https://tex.s2cms.ru/svg/A_1%20%3D%200.3" alt="A1 = 0.3" /> - амплитуда первой синусоиды;</li>
<li><img class="image__inline" src="https://tex.s2cms.ru/svg/2%5Cpi%5Ccfrac%7BW_1%7D%7BL_1%7D%20%3D%20%5Ccfrac%7B%5Cpi%7D%7B2%7D" alt="2pi * W1 / L1 = pi/2" /> - начальная фаза первой синусоиды;</li>
<li><img class="image__inline" src="https://tex.s2cms.ru/svg/L_2%20%3D%20%5Cpi" alt="L2 = pi" /> - период второй синусоиды;</li>
<li><img class="image__inline" src="https://tex.s2cms.ru/svg/A_2%20%3D%200.7" alt="A2 = 0.7" /> - амплитуда второй синусоиды;</li>
<li><img class="image__inline" src="https://tex.s2cms.ru/svg/2%5Cpi%5Ccfrac%7BW_2%7D%7BL_2%7D%20%3D%20%5Ccfrac%7B%5Cpi%7D%7B3%7D" alt="2pi * W2 / L2 = pi/3" /> - начальная фаза второй синусоиды.</li>
</ul>
<p>Теперь для этого сигнала возьмем 12 отсчетов каждые <img class="image__inline" src="https://tex.s2cms.ru/svg/%5Ccfrac%7B%5Cpi%7D%7B6%7D" alt="pi/6" /> (полный период первой синусоиды) и вычислим ДПФ. Мы получим следующий набор значений: <img class="image__inline" src="https://tex.s2cms.ru/svg/%5B0%2C%200.3i%2C%200.7%20*%20(%5Ccfrac%7B1%7D%7B2%7D%20%2B%20%5Ccfrac%7B%5Csqrt%7B3%7D%7D%7B2%7Di)%2C%200%2C%200%2C%200%2C%200%2C%200%2C%200%2C%200%2C%200%2C%200%5D" alt="[0, 0.3 * i, 0.7 * (1/2 + sqrt(3)/2 * i) , 0, 0, 0, 0, 0, 0, 0, 0, 0]" />. Первое ненулевое значение описывает первую синусоиду: модуль = 0.3, аргумент = <img class="image__inline" src="https://tex.s2cms.ru/svg/%5Ccfrac%7B%5Cpi%7D%7B2%7D" alt="pi/2" />, второе значение описывает вторую синусоиду: модуль = 0.7, аргумент = <img class="image__inline" src="https://tex.s2cms.ru/svg/%5Ccfrac%7B%5Cpi%7D%7B3%7D" alt="pi/3" />. Стоит сразу заметить, что такие &quot;красивые&quot; результаты получатся только для синусоид, длина волны которых может быть представлена как B/n, где B - размер окна преобразования, n - натуральное число меньшее, либо равное, половине количества отсчетов.</p>
<h4>Интерпретация данных AnalyzerNode</h4><p><code>AnalyzerNode</code> возвращает 2 набора данных - частотные характеристики и форму волны. Тут есть несколько подводных камней и особенностей.</p>
<p>Почему-то нигде в документации не описано, в каком формате методы <code>AnalyserNode#getFloatFrequencyData</code> и <code>AnalyserNode#getByteFrequencyData</code> возвращают данные; сказано лишь, что эти данные получаются из БПФ. Нам известно, что БПФ возвращает набор комплексных чисел, но данный элемент выдает вещественные числа - они являются модулями комплексных чисел, т.е. описывают амплитуды соответствующих гармоник. Для метода <code>AnalyserNode#getFloatFrequencyData</code> данные об амплитуде указываются по шкале dBFS, а для метода <code>AnalyserNode#getByteFrequencyData</code> эта шкала еще и перенормируется с учетом параметров <code>AnalyserNode#minDecibels</code> и <code>AnalyserNode.maxDecibels</code>. Не очевидно еще вот что: размер данных о частотных характеристиках в 2 раза меньше, чем размер буфера (<code>AnalyserNode.fftSize</code>), а БПФ должно выдавать данные, соответствующие размеру буфера. Половина данных из этих результатов просто выбрасывается. Чуть позже объясню, почему для анализа она действительно мало интересна. Кстати, о том, что размер буфера данных о частотных характеристиках меньше в 2 раза, чем буфер преобразования, в документации указано в описании свойства <code>AnalyserNode.frequencyBinCount</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/API/AnalyserNode/frequencyBinCount">man</a>)</p>
<p>Выше была рассмотрена интерпретация значений частотных характеристик в системе координат преобразования, теперь стоит рассмотреть интерпретацию в системе координат цифрового сигнала. Чему равна реальная частота каждого из аргументов? Это зависит от 2х параметров: частоты дискретизации самого цифрового сигнала и размера буфера преобразования. Зависимость частоты от номера аргумента получается такая: D * (n - 1) / B, где D - частота дискретизации сигнала, B - размер буфера, n - номер аргумента. Из этого следует интересное свойство - середина буфера соответствует частоте Найквиста. Именно поэтому половина буфера выбрасывается из выдачи - она описывает частоты выше частоты Найквиста (частоту дискретизации сигнала можно узнать из <code>AudioContext#sampleRate</code>).</p>
<p>С методами <code>AnalyserNode#getFloatTimeDomainData</code> и <code>AnalyserNode#getByteTimeDomainData</code> все несколько проще - оба метода просто возвращают значения временного буфера. Значения первого идут в диапазоне от -1 до 1, значения второго - от 0 до 255.</p>
<h2>Обработка сигнала</h2><p>Основное назначние Web Audio API - это обработка сигналов. Для этих целей есть целый арсенал различных фильтров.</p>
<h3><a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioNode/connect%28AudioParam%29">AudioNode#connect(AudioParam)</a></h3><p>Как я уже упомянал выше, ноду можно подключить не только к другой ноде, но и к некому параметру. В данном случае значение сигнала будет прибавляться к собственному значению данного параметра. Таким образом можно, например, смоделировать частотную модуляцию сигнала (<a href="https://jsbin.com/sojodecijo/edit?js,output">jsbin</a>)</p>
<pre class="prettyprint source lang-(javascript)"><code>var oscillator = audioContext.createOscillator();
oscillator.frequency.value = 1000; // несущая частота будет 1 кГц
oscillator.start();

var modulatorGain = audioContext.createGain();
modulatorGain.gain.value = 500; // отклонение от несущей частоты будет +- 500 Гц.

soundStream.connect(modulatorGain);
modulatorGain.connect(oscillator.frequency);
oscillator.connect(analyzer);</code></pre><h3><a href="https://developer.mozilla.org/en-US/docs/Web/API/GainNode">GainNode</a></h3><p>Самый простой фильтр - он просто меняет громкость сигнала. При изменении значения усиления используется специальный алгоритм, который предотвращает возникновение щелчков. В отличие от большинства других фильтров, здесь используется линейная шкала усиления, а не логарифмическая (в децибелах).</p>
<h3><a href="https://developer.mozilla.org/en-US/docs/Web/API/DelayNode">DelayNode</a></h3><p>Фильтр, реализующий линию задержки. Фактически он создает задержку выходного сигнала относительно входного. Обычно используется для синхронизации различных сигналов во времени. Также данный элемент критически необходим для ситуаций, когда граф обработки сигнала содержит циклы. Если в таком графе не будет ни одного элемента <code>DelayNode</code>, то все ноды, входящие в цикл, будет отключены.</p>
<h3><a href="https://developer.mozilla.org/en-US/docs/Web/API/BiquadFilterNode">BiquadFilterNode</a></h3><p>Биквадратный фильтр относится к классу фильтров с бесконечной импульсной характеристикой (БИХ), он использует 2 последних отсчета из входного сигнала, 2 последних отсчета из выходного сигнала и текущий уровень сигнала. Эти параметры умножаются на зарнее рассчитанные коэффициенты и складываются. С помощью различных коэффициентов реализуется большое количество разнообразных фильтров. Данный тип фильтров лучше всего подходит, например, для создания <a href="https://github.yandex-team.ru/music/audio/blob/master/src/fx/equalizer/equalizer.js">эквалайзера</a>.</p>
<p><em>Все графики ниже отображают диапазон частот от 20 Гц до 20000 Гц. Горизонтальная ось отображает частоту, по ней применяется логарифмический масштаб, вертикальная - магнитуду (желтый график) от 0 до 2, или фазовый сдвиг (зеленый график) от  -Pi до Pi. Частота всех фильтров (632 Гц) отмечена красной чертой на графике.</em></p>
<h4>Lowpass</h4><p><img src="images/lowpass.png" width="100%" alt="Рис. 2. Фильтр lowpass." />
<em>Рис. 2. Фильтр lowpass.</em></p>
<p>Пропускает только частоты ниже заданной частоты. Фильтр задается частотой и добротностью.</p>
<h4>Highpass</h4><p><img src="images/highpass.png" width="100%" alt="Рис. 3. Фильтр highpass." />
<em>Рис. 3. Фильтр highpass.</em></p>
<p>Действует аналогично lowpass, за исключением того, что он пропускает частоты выше заданной, а не ниже.</p>
<h4>Bandpass</h4><p><img src="images/bandpass.png" width="100%" alt="Рис. 4. Фильтр bandpass." />
<em>Рис. 4. Фильтр bandpass.</em></p>
<p>Этот фильтр более избирателен - он пропускает только определенную полосу частот.</p>
<h4>Notch</h4><p><img src="images/notch.png" width="100%" alt="Рис. 5. Фильтр notch." />
<em>Рис. 5. Фильтр notch.</em></p>
<p>Является противоположностью bandpass - пропускает все частоты вне заданной полосы. Стоит, однако, отметить разность в графиках затухания воздействия и в фазовых характеристиках данных фильтров.</p>
<h4>Lowshelf</h4><p><img src="images/lowshelf.png" width="100%" alt="Рис. 6. Фильтр lowshelf." />
<em>Рис. 6. Фильтр lowshelf.</em></p>
<p>Является более «умной» версией highpass - усиливает или ослабляет частоты ниже заданной, частоты выше пропускает без изменений. Фильтр задается частотой и усилением.</p>
<h4>Highshelf</h4><p><img src="images/highshelf.png" width="100%" alt="Рис. 7. Фильтр highshelf." />
<em>Рис. 7. Фильтр highshelf.</em></p>
<p>Более умная версия lowpass - усиливает или ослабляет частоты выше заданной, частоты ниже пропускает без изменений.</p>
<h4>Peaking</h4><p><img src="images/peaking.png" width="100%" alt="Рис. 8. Фильтр peaking." />
<em>Рис. 8. Фильтр peaking.</em></p>
<p>Это уже более «умная» версия notch - он усиливает или ослабляет частоты в заданном диапазоне и пропускает остальные частоты без изменений. Фильтр задается частотой, усилением и добротностью.</p>
<h4>Фильтр allpass</h4><p><img src="images/allpass.png" width="100%" alt="Рис. 9. Фильтр allpass." />
<em>Рис. 9. Фильтр allpass.</em></p>
<p>Allpass отличается от всех остальных - он не меняет амплитудные характеристики сигнала, вместо чего делает фазовый сдвиг заданных частот. Фильтр задается частотой и добротностью.</p>
<h3><a href="https://developer.mozilla.org/en-US/docs/Web/API/WaveShaperNode">WaveShaperNode</a></h3><p>Как я уже говорил в статье про теорию звука, данный фильтр может применяться для создания таких эффектов, как <a href="https://en.wikipedia.org/wiki/Distortion_music">«дисторшн»</a>, <a href="https://ru.wikipedia.org/wiki/Овердрайв_%28звуковой_эффект%29">«овердрайв»</a> и <a href="https://ru.wikipedia.org/wiki/Фузз_%28эффект%29">«фузз»</a>. Этот фильтр применяет к входному сигналу специальную формирующую функцию. Конкретно данная реализация этого фильтра использует не функцию, а таблицу соответствия (табулированную функцию). Каждому значению входного уровня сигнала сопоставляется некое значение из этой таблицы (интерполированное). С помощью такой таблицы можно добиться появления новых гармоник в сигнале, за счет чего и работают перечисленные выше эффекты. При этом новые гармоники могут иметь частоты выше, чем частоты, присутствующие в изначальном сигнале, это может привести к появлению алиасов. Для компенсации данного эффекта в фильтре предусмотрена возможность повышения частоты дискретизации на время расчетов. Перед применением фильтра частота дискретизации повышается в указанное количество раз, применяется данный фильтр, затем фильтруются высокие частоты (с частотой выше частоты Найквиста для исходного сигнала) и частота снижается обратно.</p>
<p>Кривая, используемая для формирования сигнала, является результатом линейной интерполяции значений таблицы, заданной с помощью массива значений (<code>Float32Array</code>). Размер массива может быть произвольным, при этом первое значение массива считается значением функции в точке -1, последнее - значением в точке 1, остальные значения распределены с равными интервалами. К значениям применяется ограничение от -1 до 1. Все значения меньше -1 или больше 1 приводятся к -1 или 1 соответственно.</p>
<p>Неплохое видео про Waveshaper, в котором можно не только посмотреть на то, как меняется форма волны в зависимости от формирующей функции, но и послушать результат:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/SMaJ-MHyZE0?rel=0" frameborder="0" allowfullscreen></iframe>

<h3><a href="https://developer.mozilla.org/en-US/docs/Web/API/ConvolverNode">ConvolverNode</a></h3><p>Фильтр, производящий <a href="https://en.wikipedia.org/wiki/Convolution">линейную свертку</a> входного сигнала с аудиобуфером, задающим некую импульсную характеристику. Свертка аудиопотока c заданной импульсной характеристикой как бы накладывает эффекты окружения, в котором была снята импульсная характеристика на входной сигнал.</p>
<p>Данный фильтр реализует эффект <a href="https://en.wikipedia.org/wiki/Reverberation">реверберации</a>. Существует множество библиотек готовых аудиобуферов для данного фильтра, которые реализуют различные эффекты (<a href="https://www.freesound.org/people/jorickhoofd/packs/9893/">1</a>, <a href="http://www.voxengo.com/impulses/">2</a>), подобные библиотеки хорошо находятся по запросу <em>impulse response mp3</em>.</p>
<p>Также возможно применить нормализацию громкости к буферу, содержащему импульсную характеристику. При этом существует подводный камень - нужно сначала выставлять значение <code>convolver.normalize = true;</code>, а лишь затем назначать буфер, т.к. эффект от изменения данного параметра проявляется только после установки нового буфера (по умолчанию нормализация применяется).</p>
<p>Этот фильтр отличается от большинства других - в нем применяется БПФ. Это стоит учитывать, т.к. хоть оно и называется &quot;быстрое&quot; - все равно это достаточно дорогая операция, которая сильно загружает CPU (для большинства других фильтров сложность - O(n), для БПФ сложность - O(n log (n)), при этом почти везде n = 1, а для БПФ используется еще и достаточно большой буфер).</p>
<h3><a href="https://developer.mozilla.org/en-US/docs/Web/API/DynamicsCompressorNode">DynamicsCompressorNode</a></h3><p>Данный фильтр позволяет производить динамическую компрессию громкости - он динамически меняет громкость в процессе воспроизведения, снижая ее для громких фрагментов. Таким образом можно избегать клиппинга в процессе сложения и/или обработки сигналов. </p>
<p>Фильтр задается целым рядом различных параметров:</p>
<ul>
<li><code>DynamicsCompressorNode#threshold</code> - пороговое значения громкости, после которой применяется фильтр (в dBFS);</li>
<li><code>DynamicsCompressorNode#ratio</code> - коэффициент компрессии. Указывает соотношение громкости входного сигнала к громкости выходного (громкости измеряются в децибелах). Чем выше значение - тем сильнее будет эффект фильтра;</li>
<li><code>DynamicsCompressorNode#knee</code> -  указывает верхнюю границу области сглаживания. Это нужно, чтобы громкость звука не менялась резкими скачками. На деле это работает как переходная функция - если значение громкости близко к пороговому, то снижение громкости минимально, чем выше громкость и чем она ближе к верхней границе сглаживания, тем сильнее проявляется эффект фильтра. Для фрагментов с громкостью выше верхней границы сглаживания фильтр действует в полную силу.</li>
<li><code>DynamicsCompressorNode#attack</code> - еще один параметр для настройки плавных переходов. В отличие от предыдущего этот параметр регулирует скорость применения эффекта непосредственно. Задает количество секунд, за которые уровень сигнала должен быть снижен на 10 дб;
<code>DynamicsCompressorNode#release</code> - действует аналогично <code>DynamicsCompressorNode#attack</code>, но указывает не скорость снижения уровня сигнала, а наоборот - восстановления;</li>
<li><code>DynamicsCompressorNode#reduction</code> - единственный параметр, который отвечает не за настройку, а за получение данных. Указывает текущий уровень снижения громкости (в dBFS).</li>
</ul>
<p>При применении данного фильтра следует учитывать, что он значительно ухудшает звучание музыкальных композиций в большинстве случаев, особенно если выставлена высокая скорость срабатывания и низкий порог сглаживания.</p>
<h3><a href="https://developer.mozilla.org/en-US/docs/Web/API/ScriptProcessorNode">ScriptProcessorNode</a></h3><p>Данный API является заменой устаревшей версии <code>JavaScriptNode</code> и является как устаревшим с 29 августа 2014. Вместо него должно быть <em>вскоре (sic!)</em> реализовано API Audio Worker'ов, но его по-прежнему нет ни в одном браузере (по информации на 8 декабря 2015). Поэтому я опишу, что это такое и как оно работает, т.к. альтернативы нет и неизвестно, когда она появится.</p>
<p>Этот элемент позволяет производить фильтрацию сигнала &quot;вручную&quot;. Однако стоит учитывать, что вся обработка данных происходит в основном потоке и это блокирующая операция, так что не стоит пытаться писать сложные функции обработки - это серьезно скажется на быстродействии интерфейса (собственно говоря, эта причина является основной, почему этот API является устаревшим и для чего потребовалось API Audio Worker'ов).</p>
<p>Фабрика <code>AudioContext#createScriptProcessor</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioContext/createScriptProcessor">man</a>) принимает 3 параметра: размер буферов для входных и выходных данных, количество каналов входного сигнала, количество каналов выходного сигнала.</p>
<p>Обработка данных происходит внутри обработчика событий <code>audioprocess</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/Events/audioprocess">man</a>). Объект события <code>AudioProcessingEvent</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioProcessingEvent">man</a>) содержит ссылки на буферы входного и выходного сигнала, а также время воспроизведения. Для простоты назначения обработчика события <code>audioprocess</code> существует синтаксический сахар в виде свойства <code>AudioContext#onaudioprocess</code>, которому можно присвоить в качестве значения обработчик этого события. Буферы входного и выходного сигнала являются обычными экземплярами <code>AudioBuffer</code> и содержат данные о сигнале в формате PCM.</p>
<h3>3D</h3><p>В Web Audio API реализована поддержка расчета звучания для 3D окружения. Можно произвольно размещать источники звука в 3х-мерном пространстве, устанавливать позицию слушателя и получать различные эффекты окружения. Для реализации данных эффектов используется 2 класса: <code>PannerNode</code> и <code>AudioListener</code>, представляющие источник звука в 3х-мерном пространстве и слушателя соответственно.</p>
<p>Стоит сразу отметить пару особенностей в том, как используются эти сущности. <code>PannerNode</code> применяется как обычный элемент <code>AudioNode</code> - источник сигнала требуется подключить к <code>PannerNode</code>, а сам этот элемент подключить к к выходному каналу (напрямую или через другие <code>AudioNode</code>). <code>AudioListener</code> вообще не является <code>AudioNode</code>, его свойства применяются глобально ко всем элементам <code>PannerNode</code> при расчетах - не требуется ни подключать их к <code>AudioListener</code>, ни подключать его самого к выходному каналу.</p>
<h4><a href="https://developer.mozilla.org/en-US/docs/Web/API/PannerNode">PannerNode</a></h4><p>Данный элемент представляет из себя источник звука в 3х-мерном пространстве. Можно задавать следующие настройки:</p>
<ul>
<li><code>PannerNode#panningModel</code> - модель, используемая для расчета стерео-эффекта звучания. Может принимать 2 значения <code>&quot;equalpower&quot;</code> и <code>&quot;HRTF&quot;</code>.<ul>
<li><code>equalpower</code> - упрощенная и быстрая модель расчета звука. При этой модели сумма уровней сигналов из правого и левого канала равна (примерно) уровню изначального сигнала.</li>
<li><code>HRTF</code> - более точная модель расчетов, основанная на линейной свертке сигнала с импульсной характеристикой, рассчитанной для человеческой головы. Эта модель более точно распределяет сигнал по каналам с учетом физиологии человека (по умолчанию используется эта модель).</li>
</ul>
</li>
<li><code>PannerNode#refDistance</code> - расстояние от центра источника до сферы, на которой громкость звука равна громкости входного сигнала (фактически это диаметр источника звука)</li>
<li><code>PannerNode#maxDistance</code>- расстояние от центра источника до сферы, на которой громкость падает на максимальное значение (обычно до нуля). Вне данной сфере сигнал распространяется без затухания.</li>
<li><code>PannerNode#rolloffFactor</code> - коэффициент затухания звука. Эффект зависит от модели расчета затухания</li>
<li><code>PannerNode#distanceModel</code> - модель, используемая для расчета эффекта затухания звука при удалении от источника. Может принимать одно из 3х значений: <code>&quot;linear&quot;</code>, <code>&quot;inverse&quot;</code>, <code>&quot;exponential&quot;</code>. Иллюстрацию всех моделей можно посмотреть в данной <a href="https://www.desmos.com/calculator/gdakh2kznr">демонстрации</a> (k = rolloffFactor, <img class="image__inline" src="https://tex.s2cms.ru/svg/d_0" alt="d0" /> = refDistance, D = maxDistance, d = distance). Физически обоснованной моделью является модель <code>exponential</code> с <code>rolloffFactor = 2</code> - обратноквадратичное затухание:<ul>
<li><code>linear</code> <img class="image__inline" src="https://tex.s2cms.ru/svg/1%20-%20k%5Ccfrac%7Bd-d_0%7D%7BD-d_0%7D" alt="1 - rolloffFactor * (distance - refDistance) / (maxDistance - refDistance" /> - громкость пропорциональна расстоянию до сферы <code>maxDistance</code>.</li>
<li><code>inverse</code> <img class="image__inline" src="https://tex.s2cms.ru/svg/%5Ccfrac%7Bd_0%7D%7Bd_0%20%2B%20k%20(d%20-%20d_0)%7D" alt= "refDistance / (refDistance + rolloffFactor * (distance - refDistance))" /> - громкость обратно пропорциональна расстоянию до сферы <code>refDistance</code>.</li>
<li><code>exponential</code> <img class="image__inline" src="https://tex.s2cms.ru/svg/(%5Ccfrac%7Bd_0%7D%7Bd%7D)%5Ek" alt="Math.pow(refDistance / distance, rolloffFactor" /> - громкость обратно пропорциональна степени расстояния до сферы <code>refDistance</code>.</li>
</ul>
</li>
<li><code>PannerNode#coneInnerAngle</code> - каждый источник звука является не всенаправленным, а коническим. Данный параметр указывает угол в градусах при вершине внутреннего конуса звучания. Внутри этого конуса не происходит снижения громкости звука. Значение по умолчанию в 360 градусов делает источник по сути всенаправленным.</li>
<li><code>PannerNode#coneOuterAngle</code> - диаметр внешнего конуса звучания. Вне этого конуса звук будет заглушен на заданную величину. В промежутке между внутренним конусом и внешним звук будет заглушаться на величину пропорциональную расстоянию до этих конусов. Фактически этот параметр задает размер &quot;полутени&quot; звука.</li>
<li><code>PannerNode#coneOuterGain</code> - величина, на которую звук будет заглушаться вне внешнего конуса звучания.</li>
</ul>
<p>Кроме данных параметров каждый источник должен иметь некую позицию и ориентацию в пространстве. Эти параметры задаются с помощью методов:</p>
<ul>
<li><code>PannerNode#setPosition(x, y, z)</code> - устанавливает позицию в пространстве в декартовой системе координат.</li>
<li><code>PannerNode#setOrientation(x, y, z)</code> - устанавливает ориентацию в пространстве по единичному вектору направления в декартовой системе координат.</li>
<li><code>PannerNode#setVelocity(x, y, z)</code> - устанавливает вектор движения в декартовой системе координат. Значения указываются в метрах в секунду. Требуется для расчета <a href="https://ru.wikipedia.org/wiki/Эффект_Доплера">эффекта Доплера</a>, реального изменения позиции источника это не вызывает.</li>
</ul>
<p>Стоит сразу отметить, что методов для получения соответствующих значений не предусмотрено - эти параметры можно установить, но нельзя получить.</p>
<h4><a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioListener">AudioListener</a></h4><p>В отличие от <code>PannerNode</code> данный объект является свойством аудиоконтекста и в рамках одного контекста может существовать лишь в одном экземпляре. Он имеет значительно меньше настроек, чем <code>PannerNode</code>. Слушатель может иметь только позицию и ориентацию, но не может иметь скорости движения (не совсем понятно почему).</p>
<ul>
<li><code>AudioListener#setOrientation(xFront, yFront, zFront, xUp, yUp, zUp)</code> - устанавливает ориентацию слушателя в пространстве. Для этого используются 2 линейно-независимых вектора (под углом 90 градусов): вектор направления &quot;вперед&quot; и вектор направления &quot;вверх&quot;. Вектора задаются в декартовой системе координат.</li>
<li><code>AudioListener#setPosition(x, y, z)</code> - аналогично <code>PannerNode#setPosition(x, y, z)</code>  устанавливает позицию слушателя в пространстве.</li>
</ul>
<p>Плюс к тому, <code>AudioListener</code> имеет настройки для расчета эффекта Доплера:</p>
<ul>
<li><code>AudioListener#speedOfSound</code> - скорость звука. Задается в метрах в секунду. Значение по умолчанию 343.3 м/с. Стоит сразу отметить, что данный параметр влияет только на эффект Доплера, но не создает задержку звучания, связанную со скоростью распространения звука.</li>
<li><code>AudioListener#dopplerFactor</code> - коэффициент для расчета эффекта Доплера. Данный коэффициент не имеет физического смысла - это просто некий произвольный множитель, позволяющий варьировать силу эффекта. Значение 0 соответствует отсутствию данного эффекта, значение 1 соответствует нормальному проявлению эффекта в соответствии с физическими законами.</li>
</ul>
<p>Стоит отметить, что метод <code>AudioListener#setPosition(x, y, z)</code> и свойства <code>AudioListener#speedOfSound</code> и <code>AudioListener#dopplerFactor</code> в настоящий момент значатся как устаревшие в связи с большим количеством проблем в реализации расчетов эффекта Доплера. Судя по всему в дальнейшем расчет эффекта Доплера собираются вовсе убрать из Web Audio API (по крайней мере я не нашел методов, которыми заменят данную функциональность).</p>
<p>Также исключение метода <code>AudioListener#setPosition(x, y, z)</code> означает, что в будущем все расчеты придется вести в системе кординат, связанной со слушателем. При этом центр системы координат будет совпадать с позицией слушателя, в то время как ориентация системы будет незавимиса и будет совпадать с ориентацией глобальной системы координат - слушатель может иметь произвольную ориентацию в данной системе (однако, никто не мешает установить для слушателя фиксированные вектора ориентацмии и вести все расчеты в системе координат полностью, связанной со слушателем, как это обычно делается в 3D-графике).</p>
<h2>Материалы</h2><ul>
<li><a href="http://www.w3.org/TR/html5/embedded-content-0.html#the-audio-element">HTML5 Audio W3C</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API">Документация Web Audio API</a></li>
<li><a href="https://www.youtube.com/embed/SMaJ-MHyZE0?rel=0">Видео про WaveShaper</a></li>
<li><a href="http://habrahabr.ru/post/196374/">Быстрое преобразование Фурье</a>, <a href="https://ru.wikipedia.org/wiki/Быстрое_преобразование_Фурье">вики</a>, <a href="https://en.wikipedia.org/wiki/Fast_Fourier_transform">wiki</a></li>
<li><a href="http://wikisound.org/Waveshaper">Вейвшейпер</a></li>
<li><a href="https://ru.wikipedia.org/wiki/Дисторшн">Дисторшн</a></li>
<li><a href="https://ru.wikipedia.org/wiki/Овердрайв_%28звуковой_эффект%29">Овердрайв</a></li>
<li><a href="https://ru.wikipedia.org/wiki/Фузз_%28эффект%29">Фузз</a></li>
<li><a href="https://ru.wikipedia.org/wiki/Реверберация">Реверберации</a></li>
<li><a href="https://ru.wikipedia.org/wiki/Свертка_%28математический_анализ%29">Свертка</a></li>
<li><a href="https://ru.wikipedia.org/wiki/Эквалайзер">Эквалайзер</a></li>
</ul>
</article>

</section>


        

        <footer>
            Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a>
        </footer>
    </div>
</div>
<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
<script src="scripts/main.js"></script>
</body>
</html>